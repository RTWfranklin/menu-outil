<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Menu publié</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="menu-style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    // Config Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyCxVS6IvetneJ1Q5kr8t5d7F3qd8oe8KjQ",
      authDomain: "menu-outil.firebaseapp.com",
      projectId: "menu-outil",
      storageBucket: "menu-outil.appspot.com",
      messagingSenderId: "659889655771",
      appId: "1:659889655771:web:c970fa451635dac4dfe1fe",
      measurementId: "G-18ZGPKGBQD"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // Récupère l'ID depuis l'URL
    function getMenuId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    function renderMenu(menu) {
      document.getElementById('menu-title').textContent = menu.title || 'Menu';
      if(menu.banner) {
        document.getElementById('banner').src = menu.banner;
        document.getElementById('banner').style.display = '';
      }
      if(menu.logo) {
        document.getElementById('logo').src = menu.logo;
        document.getElementById('logo').style.display = '';
      }
      const categoriesDiv = document.getElementById('categories');
      categoriesDiv.innerHTML = '';
      (menu.categories || []).forEach(cat => {
        const catDiv = document.createElement('div');
        catDiv.className = 'category';
        const catTitle = document.createElement('h2');
        catTitle.textContent = cat.name || '';
        catDiv.appendChild(catTitle);
        (cat.items || []).forEach(item => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'item';
          const name = document.createElement('b');
          name.textContent = item.name || '';
          itemDiv.appendChild(name);
          if(item.price) {
            const price = document.createElement('span');
            price.textContent = ' - ' + item.price;
            itemDiv.appendChild(price);
          }
          if(item.desc) {
            const desc = document.createElement('div');
            desc.textContent = item.desc;
            itemDiv.appendChild(desc);
          }
          if(item.imgUrl) {
            const img = document.createElement('img');
            img.src = item.imgUrl;
            img.style.maxHeight = '60px';
            img.style.marginLeft = '10px';
            itemDiv.appendChild(img);
          }
          if(Array.isArray(item.badges) && item.badges.length) {
            const badges = document.createElement('span');
            badges.textContent = ' [' + item.badges.join(', ') + ']';
            badges.style.marginLeft = '7px';
            itemDiv.appendChild(badges);
          }
          catDiv.appendChild(itemDiv);
        });
        categoriesDiv.appendChild(catDiv);
      });
    }

    window.onload = function() {
      const id = getMenuId();
      if(!id) {
        document.getElementById('menu-title').textContent = 'Aucun menu trouvé.';
        return;
      }
      db.collection('public_menus').doc(id).get().then(function(doc) {
        if(doc.exists) {
          renderMenu(doc.data());
        } else {
          document.getElementById('menu-title').textContent = 'Menu introuvable.';
        }
      }).catch(function(err) {
        document.getElementById('menu-title').textContent = 'Erreur de chargement : ' + err.message;
      });
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 3px 12px #0001; }
    h1 { margin-top: 0; }
    .category { margin-bottom: 24px; }
    .item { margin-bottom: 10px; background: #f6f6f6; border-radius: 6px; padding: 8px 12px; }
    .item img { vertical-align: middle; margin-left: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="menu-title">Chargement...</h1>
    <img id="banner" style="width:100%;max-height:120px;object-fit:cover;display:none;"/>
    <img id="logo" style="max-height:60px;display:none;float:right;margin-top:-80px;"/>
    <div id="categories"></div>
  </div>
</body>
</html>
