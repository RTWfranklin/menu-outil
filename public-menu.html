<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Menu publié</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/menu-style-premium.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    // Config Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyCxVS6IvetneJ1Q5kr8t5d7F3qd8oe8KjQ",
      authDomain: "menu-outil.firebaseapp.com",
      projectId: "menu-outil",
      storageBucket: "menu-outil.appspot.com",
      messagingSenderId: "659889655771",
      appId: "1:659889655771:web:c970fa451635dac4dfe1fe",
      measurementId: "G-18ZGPKGBQD"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // Récupère l'ID depuis l'URL
    function getMenuId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    function renderMenu(menu) {
  // Génère dynamiquement tout le header premium
  var wrapper = document.querySelector('.public-menu-wrapper');
  var html = '';
  html += '<header class="public-menu-header">';
  html += '<div class="banner-logo-wrapper">';
  if (menu.banner) {
    html += '<img class="banner" src="' + menu.banner + '" alt="Bannière">';
  }
  if (menu.logo) {
    html += '<img class="logo" src="' + menu.logo + '" alt="Logo">';
  }
  html += '</div>';
  html += '<div class="public-menu-header-content">';
  html += '<h1 id="menu-title">' + (menu.title || 'Menu') + '</h1>';
  html += '</div>';
  html += '</header>';
  html += '<nav id="category-nav" class="category-nav"></nav>';
  html += '<main id="categories-list" class="categories-list"></main>';
  wrapper.innerHTML = html;

  // Génération navigation catégories
  const nav = document.getElementById('category-nav');
  const categories = menu.categories || [];
  nav.innerHTML = '';
  categories.forEach((cat, idx) => {
    const btn = document.createElement('button');
    btn.className = 'category-nav-btn';
    btn.textContent = cat.name || `Catégorie ${idx+1}`;
    btn.onclick = function() {
      document.querySelectorAll('.category-nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.category-section').forEach(sec => sec.style.display = 'none');
      document.getElementById('cat-section-' + idx).style.display = '';
      // Scroll vers la section sur mobile
      document.getElementById('cat-section-' + idx).scrollIntoView({behavior: 'smooth', block: 'start'});
    };
    if(idx === 0) btn.classList.add('active');
    nav.appendChild(btn);
  });
  // Génération sections de plats par catégorie
  const main = document.getElementById('categories-list');
  main.innerHTML = '';
  categories.forEach((cat, idx) => {
    const section = document.createElement('section');
    section.className = 'category-section';
    section.id = 'cat-section-' + idx;
    if(idx !== 0) section.style.display = 'none';
    const title = document.createElement('h2');
    title.className = 'category-section-title';
    title.textContent = cat.name || `Catégorie ${idx+1}`;
    section.appendChild(title);
    (cat.items || []).forEach(item => {
      const card = document.createElement('div');
      card.className = 'dish-card';
      if(item.imgUrl) {
        const img = document.createElement('img');
        img.src = item.imgUrl;
        img.className = 'dish-img';
        card.appendChild(img);
      }
      const info = document.createElement('div');
      info.className = 'dish-info';
      const name = document.createElement('div');
      name.className = 'dish-title';
      name.textContent = item.name || '';
      info.appendChild(name);
      if(item.desc) {
        const desc = document.createElement('div');
        desc.className = 'dish-desc';
        desc.textContent = item.desc;
        info.appendChild(desc);
      }
      if(Array.isArray(item.badges) && item.badges.length) {
        const badges = document.createElement('span');
        badges.className = 'badges';
        badges.textContent = item.badges.join(', ');
        info.appendChild(badges);
      }
      card.appendChild(info);
      if(item.price) {
        const price = document.createElement('div');
        price.className = 'dish-price';
        price.textContent = item.price;
        card.appendChild(price);
      }
      section.appendChild(card);
    });
    main.appendChild(section);
  });
}

    window.onload = function() {
      const id = getMenuId();
      if(!id) {
        document.getElementById('menu-title').textContent = 'Aucun menu trouvé.';
        return;
      }
      db.collection('public_menus').doc(id).get().then(function(doc) {
        if(doc.exists) {
          renderMenu(doc.data());
        } else {
          document.getElementById('menu-title').textContent = 'Menu introuvable.';
        }
      }).catch(function(err) {
        document.getElementById('menu-title').textContent = 'Erreur de chargement : ' + err.message;
      });
    }
  </script>

</head>
<body>
  <div class="public-menu-wrapper">

    <nav id="category-nav" class="category-nav"></nav>
    <main id="categories-list" class="categories-list"></main>
  </div>
<script>
window.addEventListener('DOMContentLoaded', function() {
  var el = document.querySelector('.public-menu-header-content');
  if(el) el.style.marginTop = '76px';
});
</script>
  <footer style="text-align:center; margin: 48px 0 18px 0; font-size:0.98em; color:#888;">
    <a href="mentions-legales.html">Mentions légales</a> |
    <a href="politique-confidentialite.html">Politique de confidentialité</a>
  </footer>
</body>
</html>
